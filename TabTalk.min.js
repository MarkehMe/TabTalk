/* TabTalk v1.0.0 (https://github.com/MarkehMe/TabTalk). Copyright (c) 2015 Mark Hughes <mark@markeh.me>. Released under the MIT license */ var TabTalk={};TabTalk.options={};TabTalk.options.ignoreMessagesFromSelf=true;TabTalk.options.updateInterval=500;TabTalk.id=Math.floor(Math.random()*1000000000);TabTalk.callback=null;TabTalk.ourLength=0;TabTalk.read=null;TabTalk.load=function(){TabTalk.read=new Array();var a=JSON.parse(localStorage.getItem("TabTalkData"));TabTalk.ourLength=a.length;for(row in a){if(!a.hasOwnProperty(row)){continue}if(a[row].from==TabTalk.id&TabTalk.options.ignoreMessagesFromSelf){continue}TabTalk.read.push(a[row].timestamp+"/"+a[row].from)}TabTalk.timer=setInterval(function(){if(TabTalk.callback!=null){var b=JSON.parse(localStorage.getItem("TabTalkData"));if(TabTalk.ourLength!=b.length){for(row in b){if(!b.hasOwnProperty(row)){continue}if(b[row].from==TabTalk.id&TabTalk.options.ignoreMessagesFromSelf){continue}if(TabTalk.read.indexOf(b[row].timestamp+"/"+b[row].from)>-1){continue}TabTalk.read.push(b[row].timestamp+"/"+b[row].from);TabTalk.callback(b[row])}}TabTalk.ourLength=b.length}},TabTalk.options.updateInterval)};TabTalk.setCallback=function(a){TabTalk.callback=a};TabTalk.talk=function(c){var b={timestamp:(new Date()).getTime(),from:TabTalk.id,message:c};var a=JSON.parse(localStorage.getItem("TabTalkData"));if(a==null){a=[]}else{a.push(b)}localStorage.setItem("TabTalkData",JSON.stringify(a))};if(window.addEventListener){window.addEventListener("DOMContentLoaded",TabTalk.load)}else{window.attachEvent("onload",TabTalk.load)}function Talk(a){return(TabTalk.talk(a))};